# Paqet-Tunnel-Manager

اسکریپت مدیریتی برای **paqet**: یک تونل مبتنی بر Raw Socket و KCP که برای عبور از فایروال و DPI طراحی شده است. این اسکریپت از سناریوی **سرور خارج (Kharej)** و **کلاینت ایران (Entry Point)** پشتیبانی می‌کند.

---

## فهرست مطالب

* [شروع سریع](#شروع-سریع)
* [مراحل نصب](#مراحل-نصب)

  * [مرحله ۱: راه‌اندازی سرور خارج (Kharej – VPN Server)](#مرحله-۱-راهاندازی-سرور-خارج-kharej--vpn-server)
  * [مرحله ۲: راه‌اندازی سرور ایران (Iran – Client/Entry Point)](#مرحله-۲-راهاندازی-سرور-ایران-iran--cliententry-point)
* [تنظیمات پیشرفته (حالت‌های KCP)](#تنظیمات-پیشرفته-حالتهای-kcp)
* [بهینه‌سازی شبکه (اختیاری)](#بهینهسازی-شبکه-اختیاری)
* [ابزارهای استفاده‌شده](#ابزارهای-استفادهشده)
* [عیب‌یابی: مشکلات نصب Paqet](#عیبیابی-مشکلات-نصب-paqet)
* [نیاز به کمک؟](#️-نیاز-به-کمک)
* [پیش‌نیازها](#پیشنیازها)
* [لایسنس](#لایسنس)
* [قدردانی](#قدردانی)

---

## شروع سریع

اسکریپت را روی **هر دو سرور** و با دسترسی **root** اجرا کنید:

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/behzadea12/Paqet-Tunnel-Manager/main/paqet-manager.sh)
```

سپس **گزینه 0** و بعد **گزینه 1** را برای نصب پیش‌نیازها انتخاب کنید.

---

## مراحل نصب

### مرحله ۱: راه‌اندازی سرور خارج (Kharej – VPN Server)

اسکریپت را اجرا کنید:

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/behzadea12/Paqet-Tunnel-Manager/main/paqet-manager.sh)
```

#### مراحل پیکربندی

1. **گزینه 2** را انتخاب کنید (Kharej)
2. **یک نام دلخواه** برای تونل بین دو سرور وارد کنید
3. **Enter** بزنید *(اتوماتیک)*
4. **Enter** بزنید *(اتوماتیک)*
5. **Enter** بزنید *(اتوماتیک)*
6. **پورت ارتباطی بین دو سرور** را وارد کنید (مثال: `555`)
7. **کلید سکرت ساخته‌شده را ذخیره کنید**، سپس **`Y`** را بزنید
8. **گزینه 1** را انتخاب کنید
9. **گزینه 2** را انتخاب کنید
10. **پورت یا پورت‌های V2Ray / OpenVPN** را وارد کنید
    تک پورت: `555` — چند پورت: `555,666,777`

---

### مرحله ۲: راه‌اندازی سرور ایران (Iran – Client/Entry Point)

#### مراحل پیکربندی

1. **گزینه 3** را انتخاب کنید (Iran)
2. **آی‌پی سرور خارج** را وارد کنید
3. **پورت ارتباطی بین دو سرور** را وارد کنید (مثال: `555`)
4. **کلید سکرت** که روی سرور خارج ساخته شده را وارد کنید
5. **یک نام دلخواه** برای تونل بین دو سرور وارد کنید
6. **Enter** بزنید *(اتوماتیک)*
7. **Enter** بزنید *(اتوماتیک)*
8. **Enter** بزنید *(اتوماتیک)*
9. **گزینه 1** را انتخاب کنید
10. **گزینه 2** را انتخاب کنید
11. **پورت یا پورت‌های V2Ray / OpenVPN** را وارد کنید
    تک پورت: `555` — چند پورت: `555,666,777`

---

## تنظیمات پیشرفته (حالت‌های KCP)

در **مرحله 8 (سرور خارج)** و **مرحله 9 (سرور ایران)** می‌توانید حالت‌های مختلف KCP را انتخاب کنید.

### حالت‌های KCP

0. **normal** – سرعت نرمال، تأخیر نرمال، مصرف منابع کم
1. **fast** – سرعت متعادل، تأخیر کم، مصرف منابع نرمال
2. **fast2** – سرعت بالا، تأخیر کمتر، مصرف منابع متوسط
3. **fast3** – حداکثر سرعت، تأخیر بسیار کم، مصرف CPU بالا
4. **manual** – تنظیمات پیشرفته به‌صورت دستی

> **پیشنهاد:**
> طبق بازخورد کاربرانی که از این اسکریپت استفاده کرده‌اند، **گزینه 1 (fast)** در اکثر شرایط بهترین عملکرد را دارد.
> اگر **سرور ایران شما محدودیت شبکه یا منابع** دارد، پیشنهاد می‌شود حالت‌های مختلف را تست کنید.
> در صورتی که **دانش فنی و تجربه کافی** دارید، می‌توانید از **manual** برای تنظیم دقیق همه پارامترها استفاده کنید.

---

## بهینه‌سازی شبکه (اختیاری)

اسکریپت را اجرا کنید:

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/behzadea12/Paqet-Tunnel-Manager/main/paqet-manager.sh)
```

سپس **گزینه 7** را انتخاب کرده و یکی از موارد زیر را انتخاب کنید:

1. **BBR** – بهینه‌ساز کنترل ازدحام TCP *(پیشنهادی برای سرور خارج)*
2. **DNS Finder** – یافتن بهترین DNS برای ایران *(پیشنهادی برای سرور ایران)*
3. **Mirror Selector** – یافتن سریع‌ترین مخزن APT *(پیشنهادی برای سرور ایران)*

---

## ابزارهای استفاده‌شده

* **BBR – TCP Congestion Control Optimizer**
  [https://github.com/teddysun/across/](https://github.com/teddysun/across/)

* **IranDNSFinder – یافتن و تنظیم بهترین DNSها برای ایران**
  [https://github.com/alinezamifar/IranDNSFinder](https://github.com/alinezamifar/IranDNSFinder)

* **DetectUbuntuMirror – انتخاب سریع‌ترین APT Mirror (Ubuntu/Debian)**
  [https://github.com/alinezamifar/DetectUbuntuMirror](https://github.com/alinezamifar/DetectUbuntuMirror)

---

## عیب‌یابی: مشکلات نصب Paqet

اگر در هنگام پیکربندی، نصب Paqet به‌صورت خودکار انجام نشد
(مثلاً پیام **"Failed to install Paqet"** نمایش داده شد یا اسکریپت هنگام افزودن کانفیگ در حالت **Kharej** یا **Iran** متوقف شد)، مراحل زیر را انجام دهید:

### 1. دانلود دستی فایل Paqet

به صفحه ریلیز رسمی مراجعه کنید:
[https://github.com/hanselime/paqet/releases](https://github.com/hanselime/paqet/releases)

* **آخرین نسخه** را دانلود کنید (مثلاً `v1.0.0-alpha.13` یا جدیدتر)
* فایل متناسب با معماری سرور خود را انتخاب کنید:

  * `paqet-linux-amd64-*.tar.gz` → برای سرورهای 64 بیتی (x86_64 / amd64)
  * `paqet-linux-arm64-*.tar.gz` → برای سرورهای ARM (aarch64 / arm64)

### 2. قرار دادن فایل در مسیر مشخص‌شده

فایل دانلودشده را در مسیر زیر قرار دهید:

```bash
/root/paqet/
```

اگر این پوشه وجود ندارد، ابتدا آن را بسازید:

```bash
mkdir -p /root/paqet
```

### 3. اجرای مجدد اسکریپت

اسکریپت به‌صورت خودکار فایل موجود در `/root/paqet/` را شناسایی کرده، استخراج می‌کند و نصب را کامل می‌کند:

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/behzadea12/Paqet-Tunnel-Manager/main/paqet-manager.sh)
```

---

## ⚠️ نیاز به کمک؟

در صورت بروز هرگونه مشکل، از طریق تلگرام با من در ارتباط باشید:

**@behzad_developer**

معمولاً آنلاین هستم و در سریع‌ترین زمان ممکن کمکتان می‌کنم.

---

## پیش‌نیازها

* سرور لینوکسی (Ubuntu، Debian، CentOS و ...)
* دسترسی root
* `libpcap-dev`
* `iptables`
* `paqet`

---

## لایسنس

این پروژه تحت **لایسنس MIT** منتشر شده است.

---

## قدردانی

* **paqet** – کتابخانه تونل‌سازی Raw Packet نوشته‌شده توسط hanselime
  [https://github.com/hanselime/paqet](https://github.com/hanselime/paqet)
